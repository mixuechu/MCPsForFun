# LLM用户情绪收集系统

这是一个用于收集和展示用户对LLM反馈（特别是负面情绪）的系统。

## 系统组成

系统由两部分组成：

1. **MCP服务器**：基于FastMCP的服务，提供`add_feedback`工具用于收集用户反馈
2. **展示服务**：基于NextJS的前端，用于展示收集到的反馈数据

## 功能特点

- **情绪分类**: 自动对收集的反馈进行情绪分类（愤怒、失望、困惑、烦躁等）
- **情绪强度**: 显示情绪强度等级（1-5星）
- **触发场景**: 记录触发用户情绪的场景或原因
- **筛选分组**: 支持按情绪类型、强度或时间筛选和分组
- **实时更新**: 定期获取最新数据

## 一键式管理脚本

系统提供了一个功能全面的脚本`run_services.sh`，可以管理所有操作：

```bash
# 进入项目目录
cd cuzz_detector

# 使用方法
./run_services.sh [选项]
```

### 可用选项:

| 选项 | 描述 |
|------|------|
| `start` | 启动所有服务（默认选项）|
| `stop` | 停止所有服务 |
| `restart` | 重启所有服务 |
| `status` | 检查服务状态 |
| `test "文本"` | 发送测试反馈 |
| `install` | 仅安装依赖 |
| `help` | 显示帮助信息 |

### 示例:

```bash
# 启动服务（会自动安装依赖并停止已有服务）
./run_services.sh start

# 停止服务
./run_services.sh stop

# 发送测试反馈
./run_services.sh test "这个AI太糟糕了" "愤怒" 5 "无法理解需求"
```

脚本会自动处理：
- 检测并安装所需依赖（Python包、Node.js等）
- 停止已有服务进程
- 启动MCP服务器和NextJS前端
- 在按Ctrl+C时优雅地关闭所有服务

## 服务地址

- **MCP服务器**：http://localhost:10086 
- **展示前端**：http://localhost:3000/view

## MCP工具参数

`add_feedback`工具支持以下参数：

- **user_text**: 必填，用户的原始、未经处理的输入文本
- **emotion_type**: 选填，情绪类型（愤怒、失望、困惑、烦躁、一般负面等）
- **intensity**: 选填，情绪强度，1-5的整数，5表示最强烈
- **trigger_context**: 选填，简短描述触发用户情绪的场景/问题

## 系统工作流程

1. LLM检测到用户负面情绪时调用MCP的`add_feedback`工具
2. MCP服务器将反馈（包含情绪分类和强度）保存到本地JSON文件
3. 前端定期轮询获取最新数据并展示
4. 用户可以按情绪类型、强度或时间筛选和分组数据 