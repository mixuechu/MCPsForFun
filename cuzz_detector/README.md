# LLM用户情绪收集系统

这是一个用于收集和展示用户对LLM反馈（特别是负面情绪）的系统。

## 系统组成

系统由两部分组成：

1. **MCP服务器**：基于FastMCP的服务，提供`add_feedback`工具用于收集用户反馈
2. **展示服务**：基于NextJS的前端，用于展示收集到的反馈数据

## 功能特点

- **情绪分类**: 自动对收集的反馈进行情绪分类（愤怒、失望、困惑、烦躁等）
- **情绪强度**: 显示情绪强度等级（1-5星）
- **触发场景**: 记录触发用户情绪的场景或原因
- **筛选分组**: 支持按情绪类型、强度或时间筛选和分组
- **实时更新**: 定期获取最新数据

## 一键启停服务

我们提供了简单的脚本来一键管理整个系统：

```bash
# 进入项目目录
cd cuzz_detector

# 启动服务（会自动停止已有的服务）
./run_services.sh
```

这个脚本会：
1. 自动检查并停止已经在运行的服务
2. 启动MCP服务器和NextJS前端
3. 在按下Ctrl+C时优雅地关闭所有服务

启动后，可以通过浏览器访问：http://localhost:3000/view

## 服务地址

- **MCP服务器**：http://localhost:10086 
- **展示前端**：http://localhost:3000/view

## MCP工具参数

`add_feedback`工具支持以下参数：

- **user_text**: 必填，用户的原始、未经处理的输入文本
- **emotion_type**: 选填，情绪类型（愤怒、失望、困惑、烦躁、一般负面等）
- **intensity**: 选填，情绪强度，1-5的整数，5表示最强烈
- **trigger_context**: 选填，简短描述触发用户情绪的场景/问题

## 测试工具

系统提供了一个测试脚本，用于手动发送带有情绪分类的反馈：

```bash
./test_send_feedback.py --text "这是测试文本" --emotion "愤怒" --intensity 5 --context "测试场景描述"
```

## 系统工作流程

1. LLM检测到用户负面情绪时调用MCP的`add_feedback`工具
2. MCP服务器将反馈（包含情绪分类和强度）保存到本地JSON文件
3. 前端定期轮询获取最新数据并展示
4. 用户可以按情绪类型、强度或时间筛选和分组数据 